<?xml version="1.0" encoding="UTF-8"?>

<!--日誌級別以及優先級排序: OFF > FATAL > ERROR > WARN > INFO > DEBUG > TRACE > ALL -->
<!--Configuration后面的status，这个用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，你会看到log4j2内部各种详细输出-->
<!--monitorInterval：Log4j2 自動檢測修改配置文件和重新配置本身，設置間隔秒數-->
<configuration status="OFF" monitorInterval="30">

    <Properties>
        <!-- 格式化輸出：
            %date表示日期，%thread表示線程名，
            %-5level：級別從左顯示5個字符寬度
            %msg：日誌消息，%n是換行符
            %tid: thread id-->
        <!-- %logger{36} 表示Logger 名字最長36個字符-->
        <property name="LOG_PATTERN" value ="%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} %highlight{${LOG_LEVEL_PATTERN:-%5p}}{FATAL=red blink, ERROR=red, WARN=yellow bold, INFO=green, DEBUG=green bold, TRACE=blue} %style{${sys:PID}}{magenta} [%15.15t] %style{%-40.40C{1.}}{cyan} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}" />

        <!-- %X{} add the MDC value to the log-->
        <property name="LOG_PATTERN_TRAN_ID" value ="%d{${LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS}} %highlight{${LOG_LEVEL_PATTERN:-%5p}}{FATAL=red blink, ERROR=red, WARN=yellow bold, INFO=green, DEBUG=green bold, TRACE=blue} %style{${sys:PID}}{magenta} [%15.15t] %style{%-40.40C{1.}}{cyan} :  %tid [Tran Id: %X{tranId}] %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}" />
        <!-- 定義日誌存儲的路徑，不要配置相對路徑-->
        <property name="FILE_PATH" value="C:/store-logs/dev" />
        <property name="FILE_NAME" value="boot-log4j2" />
    </Properties>

    <!-- Define All Appender-->
    <appenders>

        <!-- The Console Appender Configuration-->
        <!-- Target should be either "SYSTEM_OUT" or "SYSTEM_ERR". The default is "SYSTEM_OUT". -->
        <console name="Console" target="SYSTEM_OUT">

            <!-- disableAnsi to get the color -->
            <PatternLayout pattern="${LOG_PATTERN}" disableAnsi="false"/>

            <!-- The two filter set the filter from info to warn -->
            <!--控制台只輸出level及其以上級別的信息（onMatch），其他的直接拒絕（onMismatch）-->
            <!--<ThresholdFilter level="INFO" onMatch="ACCEPT" onMismatch="DENY"/>-->
            <!--<ThresholdFilter level="WARN" onMatch="DENY" onMismatch="NEUTRAL" />-->
            <!-- The two filter END -->
        </console>

        <console name="TranIdConsole" target="SYSTEM_OUT">
            <PatternLayout pattern="${LOG_PATTERN_TRAN_ID}" disableAnsi="false"/>
        </console>


        <!-- file 会打印出所有信息，这个log每次restart spring boot 会自动清空，由append attribute 决定，这个也挺有用的，适合临时测试用-->
        <File name="File" fileName="${FILE_PATH}/test.log" append="false">
            <PatternLayout pattern="${LOG_PATTERN}"/>
        </File>

        <!-- 這個會打印出所有的info及以下級別的信息，每次大小超過size，則這size大小的日誌會自動存入按年份-月份建立的文件夾下面並進行壓縮，作為存檔 -->
        <RollingFile name="RollingFileInfo" fileName="${FILE_PATH}/logs/info.log" filePattern="${FILE_PATH}/logs/$${date:yyyy-MM}/info-%d{yyyy-MM-dd}-%i.log">
        <!--<RollingFile name="RollingFileInfo" fileName="${FILE_PATH}/info.log" filePattern="${FILE_PATH}/${FILE_NAME}-INFO-%d{yyyy-MM-dd}_%i.log.gz ">-->
            <!--控制台只輸出level及以上級別的信息（onMatch），其他的直接拒絕（onMismatch）-->
            <ThresholdFilter level="info" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <!--interval屬性用來指定多久滾動一次，默認是1 day, because the file pattern's date pattern is dd-->
                <TimeBasedTriggeringPolicy interval="1"/>
                <SizeBasedTriggeringPolicy size="100 MB"/>
            </Policies>

            <!-- DefaultRolloverStrategy同一文件夾下15個文件開始覆蓋 default 7 -->
            <!-- This strategy only matter if File pattern contain %i.
                if new file is greater than 15, the oldest file will be deleted
                    and all files will be shift 1 digit before and the new file will be xxx-15.log
                This delete function will work until the next rollover time interval-->
            <DefaultRolloverStrategy max="15"/>
        </RollingFile>


        <RollingFile name="RollingFileWarn" fileName="${FILE_PATH}/logs/warn.log"
                     filePattern="${FILE_PATH}/logs/$${date:yyyy-MM}/warn-%d{yyyy-MM-dd}-%i.log">
            <ThresholdFilter level="warn" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <TimeBasedTriggeringPolicy/>
                <SizeBasedTriggeringPolicy size="100 MB"/>
            </Policies>
            <DefaultRolloverStrategy max="20"/>
        </RollingFile>

    </appenders>

    <!--然后 definition logger，只有 definition 了logger并引入的appender，appender才会生效-->
    <loggers>


        <Logger name="com.jack.store" level="DEBUG" additivity="false">

            <AppenderRef ref="Console"/>
        </Logger>

        <!-- Filter out spring and hibernate useless DEBUG Log -->
        <root level="INFO">
            <appender-ref ref="Console"/>
            <!--<appender-ref ref="RollingFileInfo"/>-->
            <!--<appender-ref ref="RollingFileWarn"/>-->
        </root>
    </loggers>
</configuration>